(function(b){var e=null,h={},p=0,k=null,f=function(a){var d=a.target[a.type];if(b.isFunction(d)){var i=b.Event(a.type,{originalEvent:a,ovi:{latitude:a.target.coordinate.latitude,longitude:a.target.coordinate.latitude,map:h[a.target.joviID]},target:a.target});d.call(a.target.jovi,i)}},n=function(a){j&&j.done?(e=nokia.maps,a()):setTimeout(function(){n(a)},200)},q={center:[29.187778,-82.130556],zoom:10,behavior:!0,zoomBar:!0,scaleBar:!0,overview:!1,traffic:!1,publicTransport:!1,typeSelector:!0,positioning:!1,
searchManager:!1,routingManager:!1,kmlManager:!1,mapLoaded:null},l=function(a,d){if(!(this instanceof l))return new l(a,d);var b=this;this.invoked=!1;this.done=!0;this.load=function(){var a,g,e;b.invoked||(b.invoked=!0,e=function(){nokia.maps.Features.load({map:"auto",ui:"auto",search:"auto",routing:"auto",positioning:"auto",behavior:"auto",kml:"auto"},function(){b.done=!0;"function"===typeof d&&d()})},g=document.getElementsByTagName("head")[0],a=document.createElement("script"),a.src="http://api.maps.nokia.com/2.2.1/jsl.js",
a.type="text/javascript",a.charset="utf-8",a.onreadystatechange=function(){("loaded"==a.readyState||"complete"==a.readyState)&&e()},a.onload=e,g.appendChild(a))};a&&(this.done=!1,this.load())},j,m={init:function(a,d,i){a=a||{};j||(j=l(void 0===a.autoload?!0:a.autoload));var c=b(this),g=b.extend({},q,a);n(function(){null===k&&("string"===typeof d&&"string"===typeof i)&&(k={appId:d,authenticationToken:i},e.util.ApplicationContext.set(k));var a=[],f;c.data("jovi",!0);g.behavior&&a.push(new e.map.component.Behavior);
g.zoomBar&&a.push(new e.map.component.ZoomBar);g.scaleBar&&a.push(new e.map.component.ScaleBar);g.overview&&a.push(new e.map.component.Overview);g.typeSelector&&a.push(new e.map.component.TypeSelector);g.positioning&&a.push(new e.positioning.component.Positioning);g.traffic&&a.push(new e.map.component.Traffic);g.publicTransport&&a.push(new e.map.component.PublicTransport);g.contextMenu&&e.map.component.ContextMenu&&a.push(new e.map.component.ContextMenu);f=c.attr("id");f||(f="jovi"+p++,c.attr("id",
f));h[f]=new e.map.Display(c[0],{zoomLevel:g.zoom,center:g.center,components:a});h[f].mapLoaded=!1;h[f].addListener("mapviewchangeend",function(a){!1===this.mapLoaded&&(a=b.Event("maploaded",{originalEvent:a,ovi:{map:this}}),b.isFunction(g.mapLoaded)&&g.mapLoaded.call(c,a),c.trigger("maploaded",a),this.mapLoaded=!0)});c.trigger(b.Event("_initdone"))})},map:function(a){a.call(b(this),h[b(this).attr("id")])},dropMarker:function(a,d){var i=b(this).attr("id"),c,g={click:[f||b.noop,!1,null],dblclick:[f||
b.noop,!1,null],mousemove:[f||b.noop,!1,null],mouseover:[f||b.noop,!1,null],mouseout:[f||b.noop,!1,null],mouseenter:[f||b.noop,!1,null],mouseleave:[f||b.noop,!1,null],longpress:[f||b.noop,!1,null],dragstart:[f||b.noop,!1,null],drag:[f||b.noop,!1,null],dragend:[f||b.noop,!1,null]};c=b.extend({},{text:"",textColor:"#333333",fill:"#ff6347",stroke:"#333333",shape:"balloon",icon:void 0},d);c.textPen={strokeColor:c.textColor};c.pen={strokeColor:c.stroke};c.brush={color:c.fill};c.jovi=this;c.joviID=i;c.eventListener=
g;c.icon?h[i].objects.add(new e.map.Marker(a,c)):h[i].objects.add(new e.map.StandardMarker(a,c))},showInfoBubble:function(a,d){var i=b(this).attr("id"),c;c=b.extend({},{content:""},d);c.content?c.content.jquery&&(c.content.css("white-space","normal"),c.content=b("<div/>").append(c.content.clone()).html()):c.content="";(h[i].getComponentById("InfoBubbles")||h[i].addComponent(new e.map.component.InfoBubbles)).openBubble(c.content,new e.geo.Coordinate(a[0],a[1]))},setCenter:function(a,d){var e=b(this);
h[e.attr("id")].setCenter(a,d?"default":"none")},setZoom:function(a){var d=b(this);h[d.attr("id")].set("zoomLevel",a)},setType:function(a){var d=b(this),d=h[d.attr("id")];switch(a){case "map":a=d.NORMAL;break;case "satellite":a=d.SATELLITE;break;case "terrain":a=d.TERRAIN;break;default:a=d.NORMAL}d.set("baseMapType",a)},parseKml:function(a,d){var f=this;b(this).attr("id");var c=new e.kml.Manager;c.addObserver("state",function(a){"finished"==a.state&&d.call(f,a)});c.parseKML(a)},addKml:function(a,
d){var f=b(this),c=this,g=f.attr("id"),j=h[g];f.jOVI("parseKml",a,function(a){resultSet=new e.kml.component.KMLResultSet(a.kmlDocument,j);resultSet.addObserver("state",function(a){"finished"==a.state&&d.call(c,a)});j.objects.add(resultSet.create())})}};b.fn.jOVI=function(a){var d=Array.prototype.slice.call(arguments,0),e=!1;if(m[a])a=m[a],d=Array.prototype.slice.call(d,1);else if("object"==typeof a||!a)a=m.init,e=!0;else return b.error("Method "+a+" does not exist on jOVI"),this;return this.each(function(){if(j&&
j.done||e)a.apply(this,d);else b(this).one("_initdone",function(){a.apply(this,d)})})}})(jQuery);
